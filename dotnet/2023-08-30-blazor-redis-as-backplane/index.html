<!doctype html><html><head><title>Blazor Redis as Backplane</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/google-fonts/Mulish/mulish.css><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><link rel=icon type=image/png href=/images/site/favicon_hu5e0469842f323d92977e05301135eda0_41440_42x0_resize_box_3.png><meta property="og:title" content="Blazor Redis as Backplane"><meta property="og:description" content="Blazor Redis as Backplane"><meta property="og:type" content="article"><meta property="og:url" content="https://akifmt.github.io/dotnet/2023-08-30-blazor-redis-as-backplane/"><meta property="article:section" content="dotnet"><meta property="article:published_time" content="2023-08-30T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-30T00:00:00+00:00"><meta name=description content="Blazor Redis as Backplane"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu9e97de834330d7f5d59d0d943d25df7c_18556_42x0_resize_box_3.png alt=Logo>
akifmt</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link id=blog-link href=/posts/>Blog</a></li><li class=nav-item><a class=nav-link href=/dotnet/><img height=20 src=/images/dotnet-logo.png> dotnet Blog</a></li><div class=dropdown-divider id=top-navbar-divider></div><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu9e97de834330d7f5d59d0d943d25df7c_18556_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_huaeac6b74eff06a7b4d6b563d4aa0a06e_40468_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/dotnet/ data-filter=all>dotnet</a></li><div class=subtree><li><a href=/dotnet/2024-02-09-blazor-.net8-object-mapping-with-automapper/ title="Blazor .NET 8 Object Mapping with AutoMapper">Blazor .NET 8 Object Mapping with AutoMapper</a></li><li><a href=/dotnet/2024-01-24-blazor-.net8-object-mapping-with-mapster/ title="Blazor .NET 8 Object Mapping with Mapster">Blazor .NET 8 Object Mapping with Mapster</a></li><li><a href=/dotnet/2024-01-20-blazor-.net8-migrating-app-from-.net-6-or-.net-7-to-.net-8/ title="Blazor .NET 8 Migrating app from .NET 6 or .NET 7 to .NET 8">Blazor .NET 8 Migrating app from .NET 6 or .NET 7 to .NET 8</a></li><li><a href=/dotnet/2024-01-16-blazor-.net8-server-side-rendering-ssr/ title="Blazor .NET8 Server-side Rendering (SSR)">Blazor .NET8 Server-side Rendering (SSR)</a></li><li><a href=/dotnet/2024-01-13-blazor-.net8-hosting-models/ title="Blazor .NET 8 Hosting Models">Blazor .NET 8 Hosting Models</a></li><li><a href=/dotnet/2023-10-16-blazor-infinite-scrolling/ title="Blazor Infinite Scrolling">Blazor Infinite Scrolling</a></li><li><a href=/dotnet/2023-09-26-blazor-export-data-to-word-excel-pdf-csv/ title="Blazor Export Data to Word, Excel, PDF, CSV">Blazor Export Data to Word, Excel, PDF, CSV</a></li><li><a href=/dotnet/2023-09-21-blazor-external-login-identity-provider/ title="Blazor External Login Identity Provider Google, Facebook, Microsoft, Twitter">Blazor External Login Identity Provider Google, Facebook, Microsoft, Twitter</a></li><li><a href=/dotnet/2023-09-10-blazor-radzen-loading-on-page/ title="Blazor Radzen Loading on Page">Blazor Radzen Loading on Page</a></li><li><a href=/dotnet/2023-09-03-blazor-send-email-with-mailkit/ title="Blazor Send Email with MailKit">Blazor Send Email with MailKit</a></li><li><a class=active href=/dotnet/2023-08-30-blazor-redis-as-backplane/ title="Blazor Redis as Backplane">Blazor Redis as Backplane</a></li><li><a href=/dotnet/2023-08-25-blazor-resize-and-upload-images/ title="Blazor Resize and Upload Images">Blazor Resize and Upload Images</a></li><li><a href=/dotnet/2023-08-18-blazor-scheduling-with-quartz.net/ title="Blazor Scheduling with Quartz.NET">Blazor Scheduling with Quartz.NET</a></li><li><a href=/dotnet/2023-08-15-blazor-serilog-logging/ title="Blazor Serilog Logging to Console, File and Database">Blazor Serilog Logging to Console, File and Database</a></li><li><a href=/dotnet/2023-08-13-blazor-implementing-google-recaptcha-v2/ title="Blazor Implementing Google reCAPTCHA v2">Blazor Implementing Google reCAPTCHA v2</a></li><li><a href=/dotnet/2023-08-11-blazor-implementing-google-recaptcha-v3/ title="Blazor Implementing Google reCAPTCHA v3">Blazor Implementing Google reCAPTCHA v3</a></li><li><a href=/dotnet/2023-08-09-blazor-radzen-globalization-and-localization/ title="Blazor Radzen Globalization and Localization">Blazor Radzen Globalization and Localization</a></li><li><a href=/dotnet/2023-08-07-blazor-using-npm-packages/ title="Blazor Using NPM Packages">Blazor Using NPM Packages</a></li><li><a href=/dotnet/2023-08-05-blazor-generic-components/ title="Blazor Generic Components">Blazor Generic Components</a></li><li><a href=/dotnet/2023-08-02-blazor-rssfeed/ title="Blazor Expose a Feed as RSS">Blazor Expose a Feed as RSS</a></li><li><a href=/dotnet/2023-07-31-blazor-ef-multipledbproviders/ title="Blazor EF Migrations with Multiple Providers">Blazor EF Migrations with Multiple Providers</a></li><li><a href=/dotnet/2023-07-30-blazor-authentication-authorization/ title="Blazor Authentication and Authorization">Blazor Authentication and Authorization</a></li><li><a href=/dotnet/2023-07-26-blazor-radzen-crud/ title="Blazor Radzen CRUD">Blazor Radzen CRUD</a></li><li><a href=/dotnet/2023-07-21-blazor-radzen-searchcomponent/ title="Blazor Radzen SearchComponent">Blazor Radzen SearchComponent</a></li><li><a href=/dotnet/2023-07-20-blazor-plyr-video-player/ title="Blazor Plyr Video Player">Blazor Plyr Video Player</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/dotnet/2023-08-30-blazor-redis-as-backplane/blazor_dotnet_redis.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/akif_hu0b098ee5eab0ebaed64b2691fffe1073_4640_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name>Akif T.</h5><p>Wednesday, August 30, 2023</p></div><div class=title><h1>Blazor Redis as Backplane</h1></div><div class=taxonomy-terms><ul style=padding-left:0><li class=rounded><a href=/tags/dotnet/ class="btn, btn-sm">Dotnet</a></li><li class=rounded><a href=/tags/blazor-redis-as-backplane/ class="btn, btn-sm">Blazor Redis as Backplane</a></li></ul></div><div class=post-content id=post-content><p style=text-align:center><img src=blazor_dotnet_redis.jpg alt=blazor_dotnet_redis title=blazor_dotnet_redis><br><p><h4 id=blazor-redis-as-backplane-with-master-and-slave><strong>Blazor Redis as Backplane (with Master and Slave)</strong></h4><p>Blazor: Blazor is a web framework developed by Microsoft that allows developers to build interactive web applications using C# instead of JavaScript. It enables the creation of <code>single-page applications (SPAs)</code> that run entirely in the browser.</p><p>Redis: Redis is an <code>open-source</code>, <code>in-memory data structure store</code> that can be used as a <code>database, cache, and message broker</code>. It provides <code>high-performance data storage</code> and retrieval, making it suitable for use in applications that require fast and scalable data access.</p><p>Redis as Backplane: In the context of a web application, a backplane is a <code>communication channel</code> that allows <code>multiple instances of the application to synchronize and share data</code>. Redis can be used as a backplane to <code>enable real-time communication</code> and data sharing between different instances of a Blazor application.</p><p>ServiceStack.Redis: ServiceStack.Redis is a <code>high-performance, feature-rich Redis client</code> library for .NET. It provides a simple and intuitive API for interacting with Redis servers and supports advanced features such as <code>connection pooling, pipelining, and pub/sub</code>.</p><p>StackExchange.Redis: StackExchange.Redis is another popular Redis client library for .NET. It is widely used and offers a <code>high-performance, low-level API for interacting with Redis servers</code>. It supports advanced features such as <code>distributed locks, Lua scripting, and Redis Cluster</code>.</p><h5 id=prerequisites><strong>Prerequisites</strong></h5><ul><li><p>Redis Server Files and Master-Slave Configurations:
<a href=https://github.com/akifmt/DotNetCoding/tree/main/src/BlazorAppwithRedis/RedisServerFiles>https://github.com/akifmt/DotNetCoding/tree/main/src/BlazorAppwithRedis/RedisServerFiles</a></p></li><li><p>Download and Run <code>RUN_SERVERS.bat</code></p></li></ul><pre tabindex=0><code>if not exist &#34;Redis-x64-3.0.504_master&#34; (
  mkdir &#34;Redis-x64-3.0.504_master&#34;
  tar -xf Redis-x64-3.0.504.zip -C &#34;Redis-x64-3.0.504_master&#34;
)

if not exist &#34;Redis-x64-3.0.504_slave&#34; (
  mkdir &#34;Redis-x64-3.0.504_slave&#34;
  tar -xf Redis-x64-3.0.504.zip -C &#34;Redis-x64-3.0.504_slave&#34;
)

start &#34;Start RedisMaster&#34; Redis-x64-3.0.504_master\redis-server.exe redis.windows.master.conf
start &#34;Start RedisSlave&#34; Redis-x64-3.0.504_slave\redis-server.exe redis.windows.slave.conf
</code></pre><ul><li>Now, Redis Master-Slave Servers are ready.<ul><li>MASTER 127.0.0.1:6379</li><li>slave 127.0.0.1:6380</li></ul></li></ul><h5 id=configurationmanagercs><strong>ConfigurationManager.cs</strong></h5><p>The <code>ConfigurationManager</code> class is defined as a static class, meaning it cannot be instantiated. It contains a single static property called <code>AppSetting</code>, which represents the application&rsquo;s configuration settings.</p><p>The <code>AppSetting</code> property is of type <code>IConfiguration</code>, which is an interface that provides access to configuration settings. This property is read-only, meaning it can only be accessed but not modified.</p><p>The class also has a static constructor, denoted by the static <code>ConfigurationManager()</code> syntax. This constructor is automatically called when the class is accessed for the first time and is used to initialize the <code>AppSetting</code> property.</p><pre tabindex=0><code>namespace BlazorAppwithRedis;

public static class ConfigurationManager
{
    public static IConfiguration AppSetting
    {
        get;
    }

    static ConfigurationManager()
    {
        AppSetting = new ConfigurationBuilder().SetBasePath(Directory.GetCurrentDirectory()).AddJsonFile(&#34;appsettings.json&#34;).Build();
    }
}
</code></pre><h5 id=connectionhelpercs><strong>ConnectionHelper.cs</strong></h5><p>The <code>ConnectionHelper</code> class is declared as a public class. Three private static fields are defined to store the Redis clients and manager: <code>_clientsManager</code>, <code>_redisClientMaster</code>, and <code>_redisClientSlave</code>.</p><p>A static constructor is defined to initialize the <code>Redis</code> connection. It is executed only once when the class is first accessed.
Inside the static constructor, the Redis clients manager is initialized with the Redis server URLs obtained from the configuration.
The Redis client instances for master and slave are obtained from the clients manager.
The lazy connection is initialized using a lambda expression that creates a connection string from the Redis server URLs and connects to the Redis server using <code>ConnectionMultiplexer</code>.</p><p>The <code>lazyConnection</code> field is declared as a <code>Lazy&lt;ConnectionMultiplexer></code> to ensure lazy initialization of the Redis connection.
A public static property <code>Connection</code> is defined to provide access to the Redis connection.
The <code>Connection</code> property returns the value of the <code>lazyConnection</code> field.
A public static method <code>GetServers()</code> is defined to get the Redis servers from the connection.</p><pre tabindex=0><code>using ServiceStack.Redis;
using StackExchange.Redis;

namespace BlazorAppwithRedis;

public class ConnectionHelper
{
    private static readonly IRedisClientsManager _clientsManager;
    private static readonly IRedisClient _redisClientMaster;
    private static readonly IRedisClient _redisClientSlave;

    static ConnectionHelper()
    {
        _clientsManager = new PooledRedisClientManager(ConfigurationManager.AppSetting[&#34;RedisURLMaster&#34;], ConfigurationManager.AppSetting[&#34;RedisURLSlave&#34;]);
        _redisClientMaster = _clientsManager.GetClient();
        _redisClientSlave = _clientsManager.GetReadOnlyClient();
        ConnectionHelper.lazyConnection = new Lazy&lt;ConnectionMultiplexer&gt;(() =&gt;
        {
            string urls = $&#34;{ConfigurationManager.AppSetting[&#34;RedisURLMaster&#34;]},{ConfigurationManager.AppSetting[&#34;RedisURLSlave&#34;]},allowAdmin=true&#34;;
            return ConnectionMultiplexer.Connect(urls);
        });
    }

    private static Lazy&lt;ConnectionMultiplexer&gt; lazyConnection;

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

    public static IEnumerable&lt;IServer&gt; GetServers()
    {
        return Connection.GetServers();
    }
}
</code></pre><h5 id=icacheservicecs><strong>ICacheService.cs</strong></h5><p><code>ICacheService</code> in the <code>BlazorAppwithRedis.Cache</code> namespace. This interface defines a set of methods that can be used to interact with a cache service.</p><p>GetConnectionState(): This method returns the connection state of the cache service. It returns a tuple containing the connection state <code>(ConnectionStates)</code> and a message <code>(string)</code> indicating the current state of the connection.</p><p>GetTTL(string key): This method returns the <code>time-to-live (TTL)</code> of a cached item specified by the key. The TTL represents the remaining time until the item expires and is automatically removed from the cache. It returns a TimeSpan object representing the remaining time.</p><p>GetDataMaster<t>(string key): This method retrieves data from the cache using the key. It returns the cached data of type <code>T</code> if it exists, or null if the data is not found.</p><p>GetDataSlave<t>(string key): This method retrieves data from a slave cache using the key. It is similar to <code>GetDataMaster</code>, but it retrieves data from a <code>read-only replica</code> of the cache.</p><p>SetDataMaster<t>(string key, T value, DateTimeOffset expirationTime): This method sets data in the cache using the <code>key, value, and expirationTime</code>. It stores the data in the master cache and specifies the expiration time for the data.</p><p>RemoveDataMaster(string key): This method removes data from the cache using the key. It deletes the data from the master cache.</p><pre tabindex=0><code>namespace BlazorAppwithRedis.Cache;

public interface ICacheService
{
    (ConnectionStates ConnectionState, string Message) GetConnectionState();

    TimeSpan? GetTTL(string key);

    T? GetDataMaster&lt;T&gt;(string key);

    T? GetDataSlave&lt;T&gt;(string key);

    bool? SetDataMaster&lt;T&gt;(string key, T value, DateTimeOffset expirationTime);

    object? RemoveDataMaster(string key);
}
</code></pre><h5 id=cacheservicecs><strong>CacheService.cs</strong></h5><p>It implements the <code>ICacheService</code> interface, which defines the contract for interacting with the cache.</p><p>private IDatabase? _db: A private field that holds the reference to the Redis database.
private ConnectionStates _connectionState: An enumeration that represents the current connection state of the cache service.
private string _currentConnectionStatusMessage: A string that stores the current connection status message.</p><p>The class also has a <code>constructor</code> that initializes the cache service by establishing a connection to <code>Redis</code>. If the connection is successful, the connection state is set to <code>Connected</code>, and the current connection status message is set to &ldquo;Connected.&rdquo; If an exception occurs during the connection process, the connection state is set to <code>NoConnection</code>, and the current connection status message is set to the error message.</p><pre tabindex=0><code>using StackExchange.Redis;
using System.Text.Json;

namespace BlazorAppwithRedis.Cache;

public enum ConnectionStates
{
    Unknown = 0, Connected = 1, NoConnection = 2,
}

public class CacheService : ICacheService
{
    private IDatabase? _db;
    private ConnectionStates _connectionState = ConnectionStates.Unknown;
    private string _currentConnectionStatusMessage;

    public CacheService()
    {
        try
        {
            _db = ConnectionHelper.Connection.GetDatabase(0);
            _connectionState = ConnectionStates.Connected;
            _currentConnectionStatusMessage = &#34;Connected.&#34;;
        }
        catch (Exception ex)
        {
            _connectionState = ConnectionStates.NoConnection;

            string errorMessage = ex.Message;

            var innerEx = ex.InnerException;
            while (innerEx != null)
            {
                errorMessage += Environment.NewLine + innerEx.Message;
                innerEx = innerEx.InnerException;
            }

            _currentConnectionStatusMessage = errorMessage;
        }
    }

    public (ConnectionStates ConnectionState, string Message) GetConnectionState() =&gt; (_connectionState, _currentConnectionStatusMessage);

    public TimeSpan? GetTTL(string key)
    {
        if (_connectionState != ConnectionStates.Connected) return null;
        var value = _db.KeyTimeToLive(key, CommandFlags.PreferMaster);
        if (value != null)
        {
            return value;
        }
        return default;
    }

    public T? GetDataMaster&lt;T&gt;(string key)
    {
        if (_connectionState != ConnectionStates.Connected) return default;
        var value = _db.StringGet(key, CommandFlags.PreferMaster);
        if (!string.IsNullOrEmpty(value))
        {
            return JsonSerializer.Deserialize&lt;T&gt;(value!);
        }
        return default;
    }

    public T? GetDataSlave&lt;T&gt;(string key)
    {
        if (_connectionState != ConnectionStates.Connected) return default;
        var value = _db.StringGet(key, CommandFlags.PreferReplica);
        if (!string.IsNullOrEmpty(value))
        {
            return JsonSerializer.Deserialize&lt;T&gt;(value!);
        }
        return default;
    }

    public bool? SetDataMaster&lt;T&gt;(string key, T value, DateTimeOffset expirationTime)
    {
        if (_connectionState != ConnectionStates.Connected) return default;
        TimeSpan expiryTime = expirationTime.DateTime.Subtract(DateTime.Now);
        var isSet = _db.StringSet(key, JsonSerializer.Serialize(value), expiryTime, flags: CommandFlags.PreferMaster);
        return isSet;
    }

    public object? RemoveDataMaster(string key)
    {
        if (_connectionState != ConnectionStates.Connected) return null;
        bool _isKeyExist = _db.KeyExists(key);
        if (_isKeyExist == true)
        {
            return _db.KeyDelete(key, CommandFlags.PreferMaster);
        }
        return false;
    }
}
</code></pre><p>GetConnectionState(): Returns the current connection state and status message of the cache service.</p><p>GetTTL(string key): Retrieves the <code>time-to-live (TTL)</code> of a cache key, which represents the remaining time until the key expires.</p><p>GetDataMaster<t>(string key): Retrieves data from the cache using the specified key, preferring the <code>master</code> node in a Redis cluster.</p><p>GetDataSlave<t>(string key): Retrieves data from the cache using the specified key, preferring a <code>replica</code> node in a Redis cluster.</p><p>SetDataMaster<t>(string key, T value, DateTimeOffset expirationTime): Stores data in the cache using the specified key, with an optional <code>expiration time</code>.</p><p>RemoveDataMaster(string key): Removes data from the cache using the specified key, preferring the <code>master node in a Redis</code> cluster.</p><h5 id=appsettingsjson><strong>appsettings.json</strong></h5><pre tabindex=0><code>{
  &#34;RedisURLMaster&#34;: &#34;127.0.0.1:6379&#34;,
  &#34;RedisURLSlave&#34;: &#34;127.0.0.1:6380&#34;,
  &#34;Logging&#34;: {
    &#34;LogLevel&#34;: {
      &#34;Default&#34;: &#34;Information&#34;,
      &#34;Microsoft.AspNetCore&#34;: &#34;Warning&#34;
    }
  },
  &#34;AllowedHosts&#34;: &#34;*&#34;
}
</code></pre><p>The above code snippet shows two key settings related to Redis: <code>RedisURLMaster and RedisURLSlave</code>. These settings define the URLs of the Redis instances that will be used as the master and slave nodes in a Redis cluster.</p><h5 id=blogpostservicecs><strong>BlogPostService.cs</strong></h5><p>BlogPostService class is structured as follows:</p><p>It imports the necessary namespaces for the <code>cache, data, and models</code>. It defines the class and its dependencies, including the <code>ApplicationDbContext and ICacheService</code>. It initializes the class with the required dependencies through the <code>constructor</code>. It provides methods for <code>retrieving, creating, updating, and deleting blog posts</code>. It includes a private method for setting the <code>blog post data</code> in the <code>cache</code>.</p><pre tabindex=0><code>using BlazorAppwithRedis.Cache;
using BlazorAppwithRedis.Data;
using BlazorAppwithRedis.Models;
using Microsoft.EntityFrameworkCore;

namespace BlazorAppwithRedis.Services;

public class BlogPostService
{
    private readonly ApplicationDbContext _context;
    private readonly ICacheService _cacheService;
    private static object _lock = new object();

    public BlogPostService(ApplicationDbContext context, ICacheService cacheService)
    {
        _context = context;
        _cacheService = cacheService;
    }

    public async Task&lt;(BlogPost? Data, string From)&gt; GetbyIdAsync(int id)
    {
        BlogPost? filteredData;
        var data = _cacheService.GetDataSlave&lt;IEnumerable&lt;BlogPost&gt;&gt;(&#34;blogpost&#34;);
        if (data is not null)
        {
            filteredData = data.Where(x =&gt; x.Id == id).FirstOrDefault();
            return (Data: filteredData, From: &#34;cache&#34;);
        }
        data = await SetBlogPostData();
        filteredData = data.Where(x =&gt; x.Id == id).FirstOrDefault();
        return (Data: filteredData, From: &#34;database&#34;);
    }

    public async Task&lt;(IEnumerable&lt;BlogPost&gt; Data, string From)&gt; GetAllAsync()
    {
        var data = _cacheService.GetDataSlave&lt;IEnumerable&lt;BlogPost&gt;&gt;(&#34;blogpost&#34;);
        if (data is not null)
            return (Data: data, From: &#34;cache&#34;);
        data = await SetBlogPostData();
        return (Data: data, From: &#34;database&#34;);
    }

    public async Task&lt;bool&gt; AddBlogPostAsync(BlogPost blogPost)
    {
        try
        {
            var result = await _context.BlogPosts.AddAsync(blogPost);
            await _context.SaveChangesAsync();
            _cacheService.RemoveDataMaster(&#34;blogpost&#34;);
            await SetBlogPostData();
        }
        catch (Exception ex)
        {
            return false;
        }
        return true;
    }

    public async Task&lt;bool&gt; UpdateBlogPostAsync(int id, BlogPost blogPost)
    {
        try
        {
            var oldBlogPost = await _context.BlogPosts.FirstOrDefaultAsync(x =&gt; x.Id == id);
            if (oldBlogPost == null) return false;
            oldBlogPost.Title = blogPost.Title;
            oldBlogPost.Content = blogPost.Content;
            await _context.SaveChangesAsync();
            _cacheService.RemoveDataMaster(&#34;blogpost&#34;);
            await SetBlogPostData();
        }
        catch (Exception ex)
        {
            return false;
        }
        return true;
    }

    public async Task&lt;bool&gt; DeletebyIdAsync(int id)
    {
        try
        {
            var blogPost = await _context.BlogPosts.FirstOrDefaultAsync(x =&gt; x.Id == id);
            if (blogPost is null)
                return false;
            _context.BlogPosts.Remove(blogPost);
            await _context.SaveChangesAsync();
            _cacheService.RemoveDataMaster(&#34;blogpost&#34;);
            await SetBlogPostData();
        }
        catch (Exception ex)
        {
            return false;
        }
        return true;
    }

    private async Task&lt;IEnumerable&lt;BlogPost&gt;&gt; SetBlogPostData()
    {
        var expirationTime = DateTimeOffset.Now.AddMinutes(5.0);
        var data = await _context.BlogPosts.ToListAsync();
        lock (_lock)
        {
            _cacheService.SetDataMaster&lt;IEnumerable&lt;BlogPost&gt;&gt;(&#34;blogpost&#34;, data, expirationTime);
        }
        return data;
    }
}
</code></pre><h4 id=source><strong>Source</strong></h4><p>Full source code is available at this repository in GitHub:
<a href=https://github.com/akifmt/DotNetCoding/tree/main/src/BlazorAppwithRedis>https://github.com/akifmt/DotNetCoding/tree/main/src/BlazorAppwithRedis</a></p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fakifmt.github.io%2fdotnet%2f2023-08-30-blazor-redis-as-backplane%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fakifmt.github.io%2fdotnet%2f2023-08-30-blazor-redis-as-backplane%2f&text=Blazor%20Redis%20as%20Backplane&via=akifmt" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fakifmt.github.io%2fdotnet%2f2023-08-30-blazor-redis-as-backplane%2f&title=Blazor%20Redis%20as%20Backplane" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fakifmt.github.io%2fdotnet%2f2023-08-30-blazor-redis-as-backplane%2f&title=Blazor%20Redis%20as%20Backplane" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Blazor%20Redis%20as%20Backplane https%3a%2f%2fakifmt.github.io%2fdotnet%2f2023-08-30-blazor-redis-as-backplane%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn btn-sm email-btn" href="mailto:?subject=Blazor%20Redis%20as%20Backplane&body=https%3a%2f%2fakifmt.github.io%2fdotnet%2f2023-08-30-blazor-redis-as-backplane%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/akifmt/akifmt.github.io/edit/main/content/dotnet/2023-08-30-Blazor-Redis-as-Backplane/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="akifmt",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#blazor-redis-as-backplane-with-master-and-slave><strong>Blazor Redis as Backplane (with Master and Slave)</strong></a><ul><li><a href=#prerequisites><strong>Prerequisites</strong></a></li><li><a href=#configurationmanagercs><strong>ConfigurationManager.cs</strong></a></li><li><a href=#connectionhelpercs><strong>ConnectionHelper.cs</strong></a></li><li><a href=#icacheservicecs><strong>ICacheService.cs</strong></a></li><li><a href=#cacheservicecs><strong>CacheService.cs</strong></a></li><li><a href=#appsettingsjson><strong>appsettings.json</strong></a></li><li><a href=#blogpostservicecs><strong>BlogPostService.cs</strong></a></li></ul></li><li><a href=#source><strong>Source</strong></a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://akifmt.github.io/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://akifmt.github.io/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://akifmt.github.io/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://akifmt.github.io/#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://akifmt.github.io/#recent-posts-dotnet>Recent Dotnet Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://akifmt.github.io/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:akifmt@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>akifmt@gmail.com</span></a></li><li><a href=https://github.com/akifmt target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>akifmt</span></a></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form action="https://github.us1.list-manage.com/subscribe/post?u=19de52a4603135aae97163fd8&amp;amp;id=094a24c76e" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div class=form-group><input type=email class=form-control id=mce-EMAIL name=EMAIL aria-describedby=emailHelp placeholder="Enter email">
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small></div><button type=submit class="btn btn-info">Submit</button></form></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">Â© 2023 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script type=text/javascript src=/js/darkreader.js></script><script type=text/javascript src=/js/darkmode-darkreader.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script><style>#consent-notice{padding:1rem;display:none;text-align:center;position:fixed;bottom:0;width:calc(100%);background:#222;color:rgba(255,255,255,.8)}#consent-notice span{margin-right:1rem}#consent-notice button{cursor:pointer;display:inline-block;width:auto}#consent-notice span a{color:inherit;text-decoration:underline;text-decoration-color:rgba(255,255,255,.5)}#consent-notice button.btn{margin-left:.5rem}#consent-notice button.btn.manage-consent{background:rgba(255,255,255,.1);font-weight:400}#consent-overlay{position:fixed;left:0;top:0;width:100%;height:100vh;display:none;background:rgba(0,0,0,.75);z-index:999999;overflow:auto;cursor:pointer}#consent-overlay.active{display:flex}#consent-overlay>div{background:#fff;width:100%;max-width:30rem;padding:1.75rem;margin:auto;cursor:initial}#consent-overlay>div>div{display:flex;align-items:flex-start;margin-bottom:1rem}#consent-overlay>div>div:last-child{margin:0}#consent-overlay h3{padding-top:0}#consent-overlay input{margin-top:.7rem;margin-right:.3rem}#consent-overlay label{display:block}#consent-overlay .btn{margin-right:.5rem}#consent-overlay button.btn.save-consent{background:rgba(0,0,0,.6);font-weight:400}@media(max-width:767px){#consent-overlay>div{padding:1.75rem 1rem}#consent-notice span{display:block;padding-top:3px;margin-bottom:1.5rem}#consent-notice button.btn{position:relative;bottom:4px}}</style><div id=consent-notice><span>We would like to use <a class=manage-consent href=#manage-consent>third party code</a> to improve the functionality of this website.</span><button class="btn manage-consent">Manage preferences</button><button class="btn deny-consent">Deny</button><button class="btn approve-consent">Allow</button></div><div id=consent-overlay><div><div><input type=checkbox id=item0 value=1 name=item0 checked disabled>
<label for=item0><h3>Google Anaytics (functional)</h3><p>This code gives us insight into the number of people that visit our website, where they are from and what they are clicking on.</p></label></div><div><input type=checkbox id=item1 value=1 name=item1>
<label for=item1><h3>Test</h3><p>Test.</p></label></div><div><button id=save-consent class="btn save-consent" data-consentvalue=0>Save preferences</button>
<button class="btn approve-consent">Allow all</button></div></div></div><script>const scripts=[];scripts[0]="/js/scriptAAA.js";function createCookie(e,t,n){var s,o="";n&&(s=new Date,s.setTime(s.getTime()+n*24*60*60*1e3),o="; expires="+s.toUTCString()),document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t,s=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(t=o[n];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(s)==0)return t.substring(s.length,t.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}function denyAllConsentScripts(){var e="";scripts.forEach(function(){e=e+"0"}),acceptSomeConsentScripts(e)}function acceptAllConsentScripts(){var e="";scripts.forEach(function(){e=e+"1"}),acceptSomeConsentScripts(e)}function acceptSomeConsentScripts(e){setConsentInputs(e),createCookie("consent-settings",e,31),document.getElementById("consent-notice").style.display="none",document.getElementById("consent-overlay").classList.remove("active"),loadConsentScripts(e)}function loadConsentScripts(e){scripts.forEach(function(t,n){if(e[n]=="1"){var s=document.createElement("script");s.type="text/javascript",s.src=t,document.body.appendChild(s)}})}function setConsentInputs(e){var t=document.querySelectorAll("#consent-overlay input:not([disabled])");t.forEach(function(t,n){e[n]=="1"?t.checked=!0:t.checked=!1})}function setConsentValue(){var t=document.querySelectorAll("#consent-overlay input:not([disabled])"),e="";t.forEach(function(t){t.checked?e=e+"1":e=e+"0"}),document.getElementById("save-consent").dataset.consentvalue=e}var elements=document.querySelectorAll("#consent-overlay input:not([disabled])"),consentValue;elements.forEach(function(e){e.checked=!1}),readCookie("consent-settings")?(consentValue=readCookie("consent-settings").toString(),setConsentInputs(consentValue),loadConsentScripts(consentValue)):document.getElementById("consent-notice").style.display="block",elements=document.querySelectorAll(".manage-consent"),elements.forEach(function(e){e.addEventListener("click",function(){document.getElementById("consent-overlay").classList.toggle("active")})}),elements=document.querySelectorAll(".deny-consent"),elements.forEach(function(e){e.addEventListener("click",function(){denyAllConsentScripts()})}),elements=document.querySelectorAll(".approve-consent"),elements.forEach(function(e){e.addEventListener("click",function(){acceptAllConsentScripts()})}),document.getElementById("save-consent").addEventListener("click",function(){setConsentValue(),acceptSomeConsentScripts(this.dataset.consentvalue)}),document.getElementById("consent-overlay").addEventListener("click",function(e){document.querySelector("#consent-overlay > div").contains(e.target)||this.classList.toggle("active")})</script><script type=text/javascript src=/js/ga.js></script></body></html>